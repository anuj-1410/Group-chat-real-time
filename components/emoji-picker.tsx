"use client"

import { useState, useRef, useEffect } from "react"
import { motion, AnimatePresence } from "framer-motion"
import { Button } from "@/components/ui/button"
import { ScrollArea } from "@/components/ui/scroll-area"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"

// Common emoji categories
const emojiCategories = {
  recent: {
    name: "Recent",
    emojis: ["ðŸ˜Š", "ðŸ‘", "â¤ï¸", "ðŸ˜‚", "ðŸŽ‰", "ðŸ”¥", "ðŸ‘", "ðŸ™", "ðŸ¥°", "ðŸ˜"],
  },
  smileys: {
    name: "Smileys",
    emojis: [
      "ðŸ˜€",
      "ðŸ˜ƒ",
      "ðŸ˜„",
      "ðŸ˜",
      "ðŸ˜†",
      "ðŸ˜…",
      "ðŸ˜‚",
      "ðŸ¤£",
      "ðŸ˜Š",
      "ðŸ˜‡",
      "ðŸ™‚",
      "ðŸ™ƒ",
      "ðŸ˜‰",
      "ðŸ˜Œ",
      "ðŸ˜",
      "ðŸ¥°",
      "ðŸ˜˜",
      "ðŸ˜—",
      "ðŸ˜™",
      "ðŸ˜š",
      "ðŸ˜‹",
      "ðŸ˜›",
      "ðŸ˜",
      "ðŸ˜œ",
      "ðŸ¤ª",
      "ðŸ¤¨",
      "ðŸ§",
      "ðŸ¤“",
      "ðŸ˜Ž",
      "ðŸ¤©",
      "ðŸ¥³",
    ],
  },
  gestures: {
    name: "Gestures",
    emojis: [
      "ðŸ‘",
      "ðŸ‘Ž",
      "ðŸ‘Œ",
      "âœŒï¸",
      "ðŸ¤ž",
      "ðŸ¤Ÿ",
      "ðŸ¤˜",
      "ðŸ¤™",
      "ðŸ‘ˆ",
      "ðŸ‘‰",
      "ðŸ‘†",
      "ðŸ‘‡",
      "â˜ï¸",
      "ðŸ‘‹",
      "ðŸ¤š",
      "ðŸ–ï¸",
      "âœ‹",
      "ðŸ––",
      "ðŸ‘",
      "ðŸ™Œ",
      "ðŸ‘",
      "ðŸ¤²",
      "ðŸ™",
      "âœï¸",
      "ðŸ’…",
      "ðŸ¤³",
      "ðŸ’ª",
      "ðŸ¦¾",
      "ðŸ¦¿",
      "ðŸ¦µ",
      "ðŸ¦¶",
    ],
  },
  objects: {
    name: "Objects",
    emojis: [
      "â¤ï¸",
      "ðŸ§¡",
      "ðŸ’›",
      "ðŸ’š",
      "ðŸ’™",
      "ðŸ’œ",
      "ðŸ–¤",
      "ðŸ¤",
      "ðŸ¤Ž",
      "ðŸ’”",
      "â£ï¸",
      "ðŸ’•",
      "ðŸ’ž",
      "ðŸ’“",
      "ðŸ’—",
      "ðŸ’–",
      "ðŸ’˜",
      "ðŸ’",
      "ðŸ’Ÿ",
      "â˜®ï¸",
      "âœï¸",
      "â˜ªï¸",
      "ðŸ•‰ï¸",
      "â˜¸ï¸",
      "âœ¡ï¸",
      "ðŸ”¯",
      "ðŸ•Ž",
      "â˜¯ï¸",
      "â˜¦ï¸",
      "ðŸ›",
      "â›Ž",
    ],
  },
  nature: {
    name: "Nature",
    emojis: [
      "ðŸ¶",
      "ðŸ±",
      "ðŸ­",
      "ðŸ¹",
      "ðŸ°",
      "ðŸ¦Š",
      "ðŸ»",
      "ðŸ¼",
      "ðŸ¨",
      "ðŸ¯",
      "ðŸ¦",
      "ðŸ®",
      "ðŸ·",
      "ðŸ¸",
      "ðŸµ",
      "ðŸ”",
      "ðŸ§",
      "ðŸ¦",
      "ðŸ¤",
      "ðŸ¦†",
      "ðŸ¦…",
      "ðŸ¦‰",
      "ðŸ¦‡",
      "ðŸº",
      "ðŸ—",
      "ðŸ´",
      "ðŸ¦„",
      "ðŸ",
      "ðŸ›",
      "ðŸ¦‹",
      "ðŸŒ",
    ],
  },
  food: {
    name: "Food",
    emojis: [
      "ðŸŽ",
      "ðŸ",
      "ðŸŠ",
      "ðŸ‹",
      "ðŸŒ",
      "ðŸ‰",
      "ðŸ‡",
      "ðŸ“",
      "ðŸˆ",
      "ðŸ’",
      "ðŸ‘",
      "ðŸ¥­",
      "ðŸ",
      "ðŸ¥¥",
      "ðŸ¥",
      "ðŸ…",
      "ðŸ†",
      "ðŸ¥‘",
      "ðŸ¥¦",
      "ðŸ¥¬",
      "ðŸ¥’",
      "ðŸŒ¶ï¸",
      "ðŸŒ½",
      "ðŸ¥•",
      "ðŸ§„",
      "ðŸ§…",
      "ðŸ¥”",
      "ðŸ ",
      "ðŸ¥",
      "ðŸ¥¯",
      "ðŸž",
    ],
  },
  activities: {
    name: "Activities",
    emojis: [
      "âš½",
      "ðŸ€",
      "ðŸˆ",
      "âš¾",
      "ðŸ¥Ž",
      "ðŸŽ¾",
      "ðŸ",
      "ðŸ‰",
      "ðŸ¥",
      "ðŸŽ±",
      "ðŸª€",
      "ðŸ“",
      "ðŸ¸",
      "ðŸ’",
      "ðŸ‘",
      "ðŸ¥",
      "ðŸ",
      "ðŸªƒ",
      "ðŸ¥…",
      "â›³",
      "ðŸª",
      "ðŸ¹",
      "ðŸŽ£",
      "ðŸ¤¿",
      "ðŸ¥Š",
      "ðŸ¥‹",
      "ðŸŽ½",
      "ðŸ›¹",
      "ðŸ›¼",
      "ðŸ›·",
      "â›¸ï¸",
    ],
  },
}

interface EmojiPickerProps {
  onEmojiSelect: (emoji: string) => void
}

export default function EmojiPicker({ onEmojiSelect }: EmojiPickerProps) {
  const [isOpen, setIsOpen] = useState(false)
  const pickerRef = useRef<HTMLDivElement>(null)

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (pickerRef.current && !pickerRef.current.contains(event.target as Node)) {
        setIsOpen(false)
      }
    }

    document.addEventListener("mousedown", handleClickOutside)
    return () => {
      document.removeEventListener("mousedown", handleClickOutside)
    }
  }, [])

  return (
    <div className="relative" ref={pickerRef}>
      <Button
        variant="ghost"
        size="icon"
        onClick={() => setIsOpen(!isOpen)}
        className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"
      >
        <span className="text-xl">ðŸ˜Š</span>
        <span className="sr-only">Emoji picker</span>
      </Button>

      <AnimatePresence>
        {isOpen && (
          <motion.div
            initial={{ opacity: 0, scale: 0.95, y: 10 }}
            animate={{ opacity: 1, scale: 1, y: 0 }}
            exit={{ opacity: 0, scale: 0.95, y: 10 }}
            transition={{ duration: 0.15 }}
            className="absolute bottom-full mb-2 right-0 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50"
          >
            <Tabs defaultValue="recent">
              <TabsList className="w-full h-auto flex overflow-x-auto p-1 bg-gray-100 dark:bg-gray-700 rounded-t-lg">
                {Object.entries(emojiCategories).map(([key, category]) => (
                  <TabsTrigger key={key} value={key} className="flex-1 py-1 px-2 text-xs">
                    {category.name}
                  </TabsTrigger>
                ))}
              </TabsList>

              {Object.entries(emojiCategories).map(([key, category]) => (
                <TabsContent key={key} value={key} className="p-0 m-0">
                  <ScrollArea className="h-48">
                    <div className="grid grid-cols-7 gap-1 p-2">
                      {category.emojis.map((emoji, index) => (
                        <Button
                          key={index}
                          variant="ghost"
                          size="icon"
                          className="h-8 w-8 text-lg hover:bg-gray-100 dark:hover:bg-gray-700"
                          onClick={() => {
                            onEmojiSelect(emoji)
                            setIsOpen(false)
                          }}
                        >
                          {emoji}
                        </Button>
                      ))}
                    </div>
                  </ScrollArea>
                </TabsContent>
              ))}
            </Tabs>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  )
}
